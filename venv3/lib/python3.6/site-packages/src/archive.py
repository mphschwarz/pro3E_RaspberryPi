import math
import time
import re

read_reg = '(-?[0-9]+\.?[0-9]+);\s(-?[0-9]+\.?[0-9]+),\s(-?[0-9]+\.?[0-9]+);\s(-?[0-9]+\.?[0-9]+),\s(-?[0-9]+\.?[0-9]+)'


class DataPoint:
    """mean data over a measuring period"""

    def __init__(self, volt, amp, total_power, real_power, imag_power, time_stamp=None):
        """
        :param volt: rms value of voltage
        :param amp: rms value of current
        """
        if not time_stamp:
            self.time_stamp = time.time()  # time stamp in unix-time
        self.voltage = volt
        self.currant = amp
        self.total_power = total_power
        self.real_power = real_power
        self.imag_power = imag_power

    def __repr__(self):
        return 't:{}; V:{}, I:{}; S: {}, P:{}, Q:{}'.format(self.time_stamp,
                                                            self.voltage, self.currant,
                                                            self.total_power, self.real_power, self.imag_power)

    def __str__(self):
        return '{}; {}, {}; {}, {}, {}'.format(self.time_stamp,
                                               self.voltage, self.currant,
                                               self.total_power, self.real_power, self.imag_power)


def make_text_file(file_path, data):
    file = open('{}/power_useage_{}'.format(file_path, int(time.time())))
    for point in data:
        file.write(point)
    return file


def read_text_file(file):
    data_points = []
    lines = open(file, 'r').readlines()
    for line in lines:
        time_stamp, voltage, currant, real_power, imag_power = re.findall(read_reg, line)[0]
        data_points.append(DataPoint(float(voltage), float(currant),
                                     float(real_power), float(imag_power),
                                     time_stamp=float(time_stamp)))
